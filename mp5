Manual PS 5

Cursors: (All types: Implicit, Explicit, Cursor FOR Loop, Parameterized Cursor)
Write a PL/SQL block of code using parameterized Cursor that will merge the data available in the
newly created table N_Roll_Call with the data available in the table O_Roll_Call. If the data in the
first table already exists in the second table then that data should be skipped.
Note: Instructor will frame the problem statement for writing PL/SQL block using all types of
Cursors in line with above statement. 



-- Creating the tables (if not already created)
CREATE TABLE O_Roll_Call (
  roll_no INT PRIMARY KEY,
  name VARCHAR(50)
);

CREATE TABLE N_Roll_Call (
  roll_no INT,
  name VARCHAR(50)
);

-- Sample Data
INSERT INTO O_Roll_Call VALUES (1, 'Amit');
INSERT INTO O_Roll_Call VALUES (2, 'Rohit');

INSERT INTO N_Roll_Call VALUES (2, 'Rohit');
INSERT INTO N_Roll_Call VALUES (3, 'Sneha');
INSERT INTO N_Roll_Call VALUES (4, 'Priya');


DELIMITER //

CREATE PROCEDURE merge_roll_call_param(IN p_min_roll INT)
BEGIN
  DECLARE done INT DEFAULT 0;
  DECLARE v_roll INT;
  DECLARE v_name VARCHAR(50);
  DECLARE existing_count INT;

  -- Parameterized Cursor: accepts roll_no limit as parameter
  DECLARE cur CURSOR FOR 
    SELECT roll_no, name 
    FROM N_Roll_Call 
    WHERE roll_no >= p_min_roll;

  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

  OPEN cur;

  read_loop: LOOP
    FETCH cur INTO v_roll, v_name;
    IF done THEN
      LEAVE read_loop;
    END IF;

    -- Check if roll_no already exists in O_Roll_Call
    SELECT COUNT(*) INTO existing_count
    FROM O_Roll_Call
    WHERE roll_no = v_roll;

    IF existing_count = 0 THEN
      INSERT INTO O_Roll_Call(roll_no, name)
      VALUES (v_roll, v_name);
      SELECT CONCAT('Inserted Roll No: ', v_roll, ' - ', v_name) AS Message;
    ELSE
      SELECT CONCAT('Duplicate Found for Roll No: ', v_roll, ' - Skipped') AS Message;
    END IF;

  END LOOP;

  CLOSE cur;
END;
//

DELIMITER ;



CALL merge_roll_call_param(2);


SELECT * FROM O_Roll_Call;




